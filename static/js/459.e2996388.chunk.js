"use strict";(self.webpackChunkbiscuit_admin_dashboard=self.webpackChunkbiscuit_admin_dashboard||[]).push([[459],{3616:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(9992),s=n(579);const i=(0,r.A)((0,s.jsx)("path",{d:"M4.25 5.61C6.27 8.2 10 13 10 13v6c0 .55.45 1 1 1h2c.55 0 1-.45 1-1v-6s3.72-4.8 5.74-7.39c.51-.66.04-1.61-.79-1.61H5.04c-.83 0-1.3.95-.79 1.61"}),"FilterAlt")},3974:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(9992),s=n(579);const i=(0,r.A)((0,s.jsx)("path",{d:"M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4"}),"AttachMoney")},9459:(e,t,n)=>{n.r(t),n.d(t,{default:()=>q});var r=n(5043),s=n(267),i=n(3969),a=n(5895),o=n(1244),l=n(6128),c=n(7873),d=n(4799),x=n(3089),h=n(6154),g=n(3699),u=n(2097),A=n(6020),f=n(8259),m=n(7443),j=n(756),p=n(6172),v=n(1341),b=n(4375),y=n(3849),w=n(3759),I=n(2272),S=n(916),P=n(1449),R=n(5979),C=n(3745),W=n(3898),k=n(7388),M=n(3616),D=n(103),E=n(8236),N=n(9992),T=n(579);const F=(0,N.A)((0,T.jsx)("path",{d:"M19 6h-2c0-2.76-2.24-5-5-5S7 3.24 7 6H5c-1.1 0-1.99.9-1.99 2L3 20c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2m-7-3c1.66 0 3 1.34 3 3H9c0-1.66 1.34-3 3-3m0 10c-2.76 0-5-2.24-5-5h2c0 1.66 1.34 3 3 3s3-1.34 3-3h2c0 2.76-2.24 5-5 5"}),"LocalMall");var V=n(3974),z=n(5472),O=n(6860),_=n(8729),L=n(7151),$=n(5180);function q(){const e=(0,s.A)(),t=(0,$.Zp)(),{userProfile:n,allUsers:N,loading:q}=(0,_.A)(),[H,U]=(0,r.useState)(!1),[G,Y]=(0,r.useState)(""),[J,B]=(0,r.useState)(""),[Z,K]=(0,r.useState)(""),[Q,X]=(0,r.useState)([]),[ee,te]=(0,r.useState)({open:!1,message:"",severity:"success"}),[ne,re]=(0,r.useState)(0),[se,ie]=(0,r.useState)(10),[ae,oe]=(0,r.useState)(0),[le,ce]=(0,r.useState)(0),[de,xe]=(0,r.useState)(0),[he,ge]=(0,r.useState)(0);(0,r.useEffect)((()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),n=new Date(e.getFullYear(),e.getMonth()+1,0);Y(t.toISOString().split("T")[0]),B(n.toISOString().split("T")[0])}),[]);const ue=(0,r.useMemo)((()=>{if(!n||!N)return[];if(!(0,L.Ic)(n))return[];if("Admin"===n.role)return N.filter((e=>"MarketingStaff"===e.role&&e.active));const e=n.id,t=(0,L.xN)(e,N);return N.filter((n=>"MarketingStaff"===n.role&&n.active&&(t.includes(n.id)||n.id===e)))}),[n,N]);(0,r.useEffect)((()=>{G&&J&&!H&&(null===N||void 0===N?void 0:N.length)>0&&Ae()}),[G,J,N]);const Ae=async()=>{if(G&&J){U(!0);try{const t=new Date(G+"T00:00:00"),n=new Date(J+"T23:59:59"),r=ue.map((e=>e.id));if(0===r.length)return X([]),te({open:!0,message:"No marketing staff found",severity:"info"}),void U(!1);const s=(0,z.P)((0,z.rJ)(O.db,"visits"),(0,z._M)("checkInTime",">=",t),(0,z._M)("checkInTime","<=",n),(0,z.My)("checkInTime","desc"));let i=(await(0,z.GG)(s)).docs.map((e=>({id:e.id,...e.data()})));i=i.filter((e=>r.includes(e.userId)));const a=new Set;i.forEach((e=>{e.inventoryEntryId&&a.add(e.inventoryEntryId)}));const o={};if(a.size>0){const e=Array.from(a).map((async e=>{try{const t=await(0,z.x7)((0,z.H9)(O.db,"inventoryEntries",e));t.exists()&&(o[e]=t.data())}catch(t){console.error(`Error fetching inventory entry ${e}:`,t)}}));await Promise.all(e)}const l=(0,z.P)((0,z.rJ)(O.db,"productRates")),c=await(0,z.GG)(l),d={};c.forEach((e=>{const t=e.data();t.productId&&t.rate&&(d[t.productId]=parseFloat(t.rate))}));const x={};let h=0,g=new Set,u=0,A=0;r.forEach((e=>{var t;x[e]={staffId:e,staffName:(null===(t=N.find((t=>t.id===e)))||void 0===t?void 0:t.name)||"Unknown",totalVisits:0,uniqueRetailers:new Set,totalProducts:0,totalSalesAmount:0,dealerName:"",dealerId:""};const n=N.find((t=>t.id===e));n&&n.assignedDealerId&&(x[e].dealerId=n.assignedDealerId)}));for(const j of i){const t=j.userId;if(x[t]&&(x[t].totalVisits++,h++,x[t].uniqueRetailers.add(j.retailerId),g.add(j.retailerId),Array.isArray(j.products))){let n=0,r=0;for(const t of j.products){const s=parseInt(t.count)||0;n+=s;let i=null;if(t.rate)i=parseFloat(t.rate);else if(j.inventoryEntryId&&o[j.inventoryEntryId]){var e;const n=null===(e=o[j.inventoryEntryId].productEntries)||void 0===e?void 0:e.find((e=>e.productId===t.productId));n&&n.rate&&(i=parseFloat(n.rate))}null===i&&d[t.productId]&&(i=d[t.productId]),null!==i&&(r+=s*i)}x[t].totalProducts+=n,x[t].totalSalesAmount+=r,u+=n,A+=r}}const f=Object.values(x).filter((e=>e.dealerId)).map((async e=>{try{const t=await(0,z.x7)((0,z.H9)(O.db,"dealers",e.dealerId));t.exists()&&(e.dealerName=t.data().name||"Unknown Dealer")}catch(t){console.error(`Error fetching dealer for ${e.staffName}:`,t)}}));await Promise.all(f);const m=Object.values(x).map((e=>({...e,uniqueRetailersCount:e.uniqueRetailers.size,visitPercentage:h?(e.totalVisits/h*100).toFixed(1):0,retailerPercentage:g.size?(e.uniqueRetailers.size/g.size*100).toFixed(1):0,productPercentage:u?(e.totalProducts/u*100).toFixed(1):0,salesPercentage:A?(e.totalSalesAmount/A*100).toFixed(1):0})));m.sort(((e,t)=>t.totalVisits-e.totalVisits)),X(m),oe(h),ce(g.size),xe(u),ge(A),0===m.length&&te({open:!0,message:"No performance data found for the selected period",severity:"info"})}catch(t){console.error("Error generating report:",t),te({open:!0,message:"Error generating report: "+t.message,severity:"error"})}finally{U(!1)}}else te({open:!0,message:"Please select a date range",severity:"warning"})},fe=(0,r.useMemo)((()=>{if(!Z.trim())return Q;const e=Z.toLowerCase();return Q.filter((t=>t.staffName.toLowerCase().includes(e)||t.dealerName.toLowerCase().includes(e)))}),[Q,Z]),me=fe.slice(ne*se,ne*se+se);return(0,L.Ic)(n)?(0,T.jsxs)(i.A,{children:[(0,T.jsx)(o.A,{sx:{borderRadius:2,boxShadow:e.shadows[2],mb:4},children:(0,T.jsxs)(l.A,{sx:{p:3},children:[(0,T.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:3},children:[(0,T.jsx)(c.A,{sx:{bgcolor:e.palette.warning.light,color:e.palette.warning.contrastText||"#fff",width:48,height:48,mr:2},children:(0,T.jsx)(R.A,{})}),(0,T.jsxs)(i.A,{children:[(0,T.jsx)(a.A,{variant:"h5",fontWeight:"bold",color:"text.primary",children:"Marketing Staff Performance Report"}),(0,T.jsx)(a.A,{variant:"body2",color:"text.secondary",children:"Consolidated performance metrics for marketing staff"})]})]}),(0,T.jsx)(d.A,{sx:{p:2,mb:4,borderRadius:2},children:(0,T.jsxs)(x.A,{container:!0,spacing:2,alignItems:"center",children:[(0,T.jsx)(x.A,{item:!0,xs:12,md:3,children:(0,T.jsx)(h.A,{label:"Search Staff or Dealer",type:"text",size:"small",fullWidth:!0,value:Z,onChange:e=>K(e.target.value),InputProps:{startAdornment:(0,T.jsx)(g.A,{position:"start",children:(0,T.jsx)(C.A,{sx:{color:e.palette.warning.main}})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),(0,T.jsx)(x.A,{item:!0,xs:12,md:3,children:(0,T.jsx)(h.A,{label:"Start Date",type:"date",size:"small",fullWidth:!0,value:G,onChange:e=>Y(e.target.value),InputLabelProps:{shrink:!0},InputProps:{startAdornment:(0,T.jsx)(g.A,{position:"start",children:(0,T.jsx)(W.A,{sx:{color:e.palette.warning.main}})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),(0,T.jsx)(x.A,{item:!0,xs:12,md:3,children:(0,T.jsx)(h.A,{label:"End Date",type:"date",size:"small",fullWidth:!0,value:J,onChange:e=>B(e.target.value),InputLabelProps:{shrink:!0},InputProps:{startAdornment:(0,T.jsx)(g.A,{position:"start",children:(0,T.jsx)(k.A,{sx:{color:e.palette.warning.main}})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),(0,T.jsx)(x.A,{item:!0,xs:12,md:3,children:(0,T.jsxs)(i.A,{sx:{display:"flex",gap:1},children:[(0,T.jsx)(u.A,{variant:"contained",onClick:Ae,disabled:H,startIcon:(0,T.jsx)(M.A,{}),sx:{borderRadius:"2rem",bgcolor:e.palette.warning.main,"&:hover":{bgcolor:e.palette.warning.dark}},children:"Apply Filters"}),(0,T.jsx)(u.A,{variant:"outlined",onClick:()=>{if(0===Q.length)return void te({open:!0,message:"No data to export",severity:"warning"});const e=Q.map((e=>[e.staffName,e.dealerName||"Not Assigned",e.totalVisits,e.uniqueRetailersCount,e.totalProducts,e.totalSalesAmount.toFixed(2),e.visitPercentage+"%",e.retailerPercentage+"%",e.productPercentage+"%",e.salesPercentage+"%"]));let t=["Marketing Staff","Assigned Dealer","Total Visits","Retailers Reached","Products Sold","Sales Amount","Visit %","Retailer %","Product %","Sales %"].join(",")+"\n";e.forEach((e=>{const n=e.map((e=>"string"===typeof e&&(e.includes(",")||e.includes('"'))?`"${e.replace(/"/g,'""')}"`:e));t+=n.join(",")+"\n"})),t=`Marketing Staff Performance Report\nDate Range: ${G} to ${J}\n\n`+t;const n=new Blob([t],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(n),s=document.createElement("a");s.href=r,s.setAttribute("download",`marketing_staff_performance_${G}_${J}.csv`),document.body.appendChild(s),s.click(),document.body.removeChild(s)},disabled:H||0===Q.length,startIcon:(0,T.jsx)(D.A,{}),sx:{borderRadius:"2rem",borderColor:e.palette.warning.main,color:e.palette.warning.main,"&:hover":{borderColor:e.palette.warning.dark}},children:"Export CSV"})]})})]})}),(0,T.jsx)(i.A,{sx:{mb:4},children:(0,T.jsxs)(x.A,{container:!0,spacing:3,children:[(0,T.jsx)(x.A,{item:!0,xs:12,sm:6,md:3,children:(0,T.jsxs)(d.A,{elevation:0,sx:{p:2,borderRadius:2,bgcolor:e.palette.warning.light,color:e.palette.warning.contrastText,textAlign:"center",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center"},children:[(0,T.jsx)(a.A,{variant:"h3",sx:{fontWeight:700,mb:1},children:ae}),(0,T.jsx)(a.A,{variant:"body1",children:"Total Visits"})]})}),(0,T.jsx)(x.A,{item:!0,xs:12,sm:6,md:3,children:(0,T.jsxs)(d.A,{elevation:0,sx:{p:2,borderRadius:2,bgcolor:e.palette.success.light,color:e.palette.success.contrastText,textAlign:"center",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center"},children:[(0,T.jsx)(a.A,{variant:"h3",sx:{fontWeight:700,mb:1},children:le}),(0,T.jsx)(a.A,{variant:"body1",children:"Retailers Reached"})]})}),(0,T.jsx)(x.A,{item:!0,xs:12,sm:6,md:3,children:(0,T.jsxs)(d.A,{elevation:0,sx:{p:2,borderRadius:2,bgcolor:e.palette.info.light,color:e.palette.info.contrastText,textAlign:"center",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center"},children:[(0,T.jsx)(a.A,{variant:"h3",sx:{fontWeight:700,mb:1},children:de}),(0,T.jsx)(a.A,{variant:"body1",children:"Products Sold"})]})}),(0,T.jsx)(x.A,{item:!0,xs:12,sm:6,md:3,children:(0,T.jsxs)(d.A,{elevation:0,sx:{p:2,borderRadius:2,bgcolor:e.palette.primary.light,color:e.palette.primary.contrastText,textAlign:"center",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center"},children:[(0,T.jsxs)(a.A,{variant:"h3",sx:{fontWeight:700,mb:1},children:["\u20b9",he.toFixed(2)]}),(0,T.jsx)(a.A,{variant:"body1",children:"Total Sales Amount"})]})})]})}),H?(0,T.jsxs)(i.A,{sx:{mb:2},children:[(0,T.jsx)(A.A,{}),(0,T.jsx)(f.A,{children:(0,T.jsxs)(m.A,{children:[(0,T.jsx)(j.A,{children:(0,T.jsxs)(p.A,{children:[(0,T.jsx)(v.A,{sx:{fontWeight:"bold"},children:"Marketing Staff"}),(0,T.jsx)(v.A,{sx:{fontWeight:"bold"},children:"Assigned Dealer"}),(0,T.jsx)(v.A,{sx:{fontWeight:"bold",textAlign:"center"},children:"Total Visits"}),(0,T.jsx)(v.A,{sx:{fontWeight:"bold",textAlign:"center"},children:"Retailers Reached"}),(0,T.jsx)(v.A,{sx:{fontWeight:"bold",textAlign:"center"},children:"Products Sold"}),(0,T.jsx)(v.A,{sx:{fontWeight:"bold",textAlign:"right"},children:"Sales Amount"}),(0,T.jsx)(v.A,{sx:{fontWeight:"bold",textAlign:"center"},children:"Contribution %"})]})}),(0,T.jsx)(b.A,{children:[...Array(5)].map(((e,t)=>(0,T.jsxs)(p.A,{children:[(0,T.jsx)(v.A,{children:(0,T.jsxs)(i.A,{sx:{display:"flex",alignItems:"center"},children:[(0,T.jsx)(y.A,{variant:"circular",width:36,height:36,sx:{mr:1.5}}),(0,T.jsx)(y.A,{variant:"text",width:120})]})}),(0,T.jsx)(v.A,{children:(0,T.jsx)(y.A,{variant:"text",width:150})}),(0,T.jsx)(v.A,{align:"center",children:(0,T.jsx)(y.A,{variant:"text",width:60})}),(0,T.jsx)(v.A,{align:"center",children:(0,T.jsx)(y.A,{variant:"text",width:60})}),(0,T.jsx)(v.A,{align:"center",children:(0,T.jsx)(y.A,{variant:"text",width:60})}),(0,T.jsx)(v.A,{align:"right",children:(0,T.jsx)(y.A,{variant:"text",width:80})}),(0,T.jsx)(v.A,{align:"center",children:(0,T.jsx)(y.A,{variant:"rounded",width:60,height:24})})]},t)))})]})})]}):0===Q.length?(0,T.jsx)(i.A,{sx:{textAlign:"center",p:4,bgcolor:"rgba(0,0,0,0.02)",borderRadius:2},children:(0,T.jsx)(a.A,{variant:"body1",color:"text.secondary",children:"No performance data found for the selected criteria"})}):(0,T.jsxs)(f.A,{children:[(0,T.jsxs)(m.A,{children:[(0,T.jsx)(j.A,{children:(0,T.jsxs)(p.A,{children:[(0,T.jsx)(v.A,{sx:{fontWeight:"bold"},children:"Marketing Staff"}),(0,T.jsx)(v.A,{sx:{fontWeight:"bold"},children:"Assigned Dealer"}),(0,T.jsx)(v.A,{sx:{fontWeight:"bold",textAlign:"center"},children:"Total Visits"}),(0,T.jsx)(v.A,{sx:{fontWeight:"bold",textAlign:"center"},children:"Retailers Reached"}),(0,T.jsx)(v.A,{sx:{fontWeight:"bold",textAlign:"center"},children:"Products Sold"}),(0,T.jsx)(v.A,{sx:{fontWeight:"bold",textAlign:"right"},children:"Sales Amount"}),(0,T.jsx)(v.A,{sx:{fontWeight:"bold",textAlign:"center"},children:"Contribution %"})]})}),(0,T.jsx)(b.A,{children:0===me.length?(0,T.jsx)(p.A,{children:(0,T.jsx)(v.A,{colSpan:7,align:"center",children:(0,T.jsx)(a.A,{variant:"body2",color:"text.secondary",children:"No matching results found"})})}):me.map((n=>{var r;return(0,T.jsxs)(p.A,{sx:{"&:hover":{bgcolor:"rgba(0,0,0,0.04)"}},onClick:()=>t(`/sales/staff/${n.staffId}/details`),style:{cursor:"pointer"},children:[(0,T.jsx)(v.A,{children:(0,T.jsxs)(i.A,{sx:{display:"flex",alignItems:"center"},children:[(0,T.jsx)(c.A,{sx:{width:36,height:36,mr:1.5,bgcolor:e.palette.warning.main},children:(null===(r=n.staffName)||void 0===r?void 0:r.charAt(0))||"?"}),(0,T.jsx)(a.A,{variant:"body2",fontWeight:500,children:n.staffName})]})}),(0,T.jsx)(v.A,{children:(0,T.jsx)(i.A,{sx:{display:"flex",alignItems:"center"},children:n.dealerName?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(E.A,{sx:{fontSize:20,mr:1,color:"text.secondary"}}),(0,T.jsx)(a.A,{variant:"body2",children:n.dealerName})]}):(0,T.jsx)(a.A,{variant:"body2",color:"text.secondary",children:"Not Assigned"})})}),(0,T.jsx)(v.A,{align:"center",children:(0,T.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,T.jsx)(a.A,{variant:"body2",fontWeight:500,children:n.totalVisits}),(0,T.jsxs)(a.A,{variant:"caption",color:"text.secondary",sx:{ml:.5},children:["(",n.visitPercentage,"%)"]})]})}),(0,T.jsx)(v.A,{align:"center",children:(0,T.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,T.jsx)(a.A,{variant:"body2",fontWeight:500,children:n.uniqueRetailersCount}),(0,T.jsxs)(a.A,{variant:"caption",color:"text.secondary",sx:{ml:.5},children:["(",n.retailerPercentage,"%)"]})]})}),(0,T.jsx)(v.A,{align:"center",children:(0,T.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,T.jsx)(F,{sx:{color:e.palette.info.main,fontSize:18,mr:.5}}),(0,T.jsx)(a.A,{variant:"body2",fontWeight:500,children:n.totalProducts}),(0,T.jsxs)(a.A,{variant:"caption",color:"text.secondary",sx:{ml:.5},children:["(",n.productPercentage,"%)"]})]})}),(0,T.jsx)(v.A,{align:"right",children:(0,T.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:[(0,T.jsx)(V.A,{sx:{color:e.palette.success.main,fontSize:18,mr:.5}}),(0,T.jsxs)(a.A,{variant:"body2",fontWeight:500,children:["\u20b9",n.totalSalesAmount.toFixed(2)]})]})}),(0,T.jsx)(v.A,{align:"center",children:(0,T.jsx)(w.A,{label:`${n.salesPercentage}%`,color:parseFloat(n.salesPercentage)>15?"success":"default",size:"small",sx:{borderRadius:"14px",fontWeight:500,minWidth:"60px"}})})]},n.staffId)}))})]}),(0,T.jsx)(I.A,{rowsPerPageOptions:[10,25,50],component:"div",count:fe.length,rowsPerPage:se,page:ne,onPageChange:(e,t)=>{re(t)},onRowsPerPageChange:e=>{ie(parseInt(e.target.value,10)),re(0)}})]})]})}),(0,T.jsx)(S.A,{open:ee.open,autoHideDuration:6e3,onClose:()=>te({...ee,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,T.jsx)(P.A,{onClose:()=>te({...ee,open:!1}),severity:ee.severity,sx:{width:"100%"},children:ee.message})})]}):(0,T.jsx)(i.A,{sx:{p:4,textAlign:"center"},children:(0,T.jsx)(a.A,{variant:"h6",color:"error",children:"You are not authorized to view staff performance reports."})})}}}]);
//# sourceMappingURL=459.e2996388.chunk.js.map