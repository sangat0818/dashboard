"use strict";(self.webpackChunkbiscuit_admin_dashboard=self.webpackChunkbiscuit_admin_dashboard||[]).push([[739],{2739:(e,t,r)=>{r.r(t),r.d(t,{default:()=>$});var i=r(5043),s=r(267),n=r(3969),l=r(5895),a=r(1244),o=r(6128),c=r(7873),d=r(4799),h=r(3089),x=r(6154),A=r(3699),g=r(6020),f=r(8259),j=r(7443),m=r(756),u=r(6172),p=r(1341),b=r(4375),v=r(3849),y=r(6529),w=r(2579),S=r(2272),C=r(916),I=r(1449),M=r(9982),k=r(3745),N=r(3241),R=r(4573),W=r(3665),P=r(9992),z=r(579);const E=(0,P.A)((0,z.jsx)("path",{d:"M23 8c0 1.1-.9 2-2 2-.18 0-.35-.02-.51-.07l-3.56 3.55c.05.16.07.34.07.52 0 1.1-.9 2-2 2s-2-.9-2-2c0-.18.02-.36.07-.52l-2.55-2.55c-.16.05-.34.07-.52.07s-.36-.02-.52-.07l-4.55 4.56c.05.16.07.33.07.51 0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2c.18 0 .35.02.51.07l4.56-4.55C8.02 9.36 8 9.18 8 9c0-1.1.9-2 2-2s2 .9 2 2c0 .18-.02.36-.07.52l2.55 2.55c.16-.05.34-.07.52-.07s.36.02.52.07l3.55-3.56C19.02 8.35 19 8.18 19 8c0-1.1.9-2 2-2s2 .9 2 2"}),"Timeline");r(5472),r(6860);var T=r(8729),D=r(5180),L=r(7151);const V=(e,t)=>{const r=t.filter((t=>t.reportingToId===e)),i=r.filter((e=>"MarketingStaff"===e.role||"Supervisor"===e.role)),s=r.filter((e=>"MarketingStaff"!==e.role&&"Supervisor"!==e.role));let n=[...i];return s.forEach((e=>{const r=V(e.id,t);n=[...n,...r]})),n};function $(){const e=(0,s.A)(),t=(0,D.Zp)(),{userProfile:r,allUsers:P,loading:$}=(0,T.A)(),[_,O]=(0,i.useState)(!1),[H,U]=(0,i.useState)(""),[Z,Y]=(0,i.useState)([]),[q,B]=(0,i.useState)([]),[F,G]=(0,i.useState)({open:!1,message:"",severity:"success"}),[J,K]=(0,i.useState)(0),[Q,X]=(0,i.useState)(10);(0,i.useEffect)((()=>{(async()=>{if(r&&P&&0!==P.length){O(!0);try{let e=[];e="Admin"===r.role?P.filter((e=>"MarketingStaff"===e.role||"Supervisor"===e.role)):V(r.id,P),Y(e),await ee(e)}catch(e){console.error("Error loading subordinates:",e),G({open:!0,message:"Error loading staff data: "+e.message,severity:"error"})}finally{O(!1)}}})()}),[r,P]);const ee=async e=>{if(e&&0!==e.length)try{const t=[];for(const r of e){const e=P.find((e=>e.id===r.reportingToId));let i=0,s=0,n=null;i=Math.floor(30*Math.random()),s=Math.floor(20*Math.random()),n=new Date(Date.now()-Math.floor(7*Math.random()*24*60*60*1e3)),t.push({...r,managerName:(null===e||void 0===e?void 0:e.name)||"N/A",managerRole:(null===e||void 0===e?void 0:e.role)||"N/A",visitCount30Days:i,retailerCount:s,lastActive:n})}B(t)}catch(t){console.error("Error enriching subordinate data:",t)}else B([])},te=(0,i.useMemo)((()=>q?q.filter((e=>!H.trim()||e.name&&e.name.toLowerCase().includes(H.toLowerCase())||e.phoneNumber&&e.phoneNumber.includes(H)||e.email&&e.email.toLowerCase().includes(H.toLowerCase()))):[]),[q,H]),re=te.slice(J*Q,J*Q+Q);return(0,L.AI)(r)?(0,z.jsxs)(n.A,{children:[(0,z.jsx)(a.A,{sx:{borderRadius:2,boxShadow:e.shadows[2],mb:4},children:(0,z.jsxs)(o.A,{sx:{p:3},children:[(0,z.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",mb:3},children:[(0,z.jsx)(c.A,{sx:{bgcolor:e.palette.warning.light,color:e.palette.warning.contrastText||"#fff",width:48,height:48,mr:2},children:(0,z.jsx)(M.A,{})}),(0,z.jsxs)(n.A,{children:[(0,z.jsx)(l.A,{variant:"h5",fontWeight:"bold",color:"text.primary",children:"Sales Staff List "}),(0,z.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"All sales staff reporting to you (directly or indirectly) "})]})]}),(0,z.jsx)(d.A,{sx:{p:2,mb:4,borderRadius:2},children:(0,z.jsx)(h.A,{container:!0,spacing:2,alignItems:"center",children:(0,z.jsx)(h.A,{item:!0,xs:12,children:(0,z.jsx)(x.A,{label:"Search by Name, Email or Phone",type:"text",size:"small",fullWidth:!0,value:H,onChange:e=>U(e.target.value),InputProps:{startAdornment:(0,z.jsx)(A.A,{position:"start",children:(0,z.jsx)(k.A,{sx:{color:e.palette.warning.main}})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})})})}),_?(0,z.jsxs)(n.A,{sx:{mb:2},children:[(0,z.jsx)(g.A,{sx:{height:6,borderRadius:3}}),(0,z.jsx)(f.A,{children:(0,z.jsxs)(j.A,{children:[(0,z.jsx)(m.A,{children:(0,z.jsxs)(u.A,{children:[(0,z.jsx)(p.A,{sx:{fontWeight:"bold"},children:"Staff Member"})," ",(0,z.jsx)(p.A,{sx:{fontWeight:"bold"},children:"Role"})," ",(0,z.jsx)(p.A,{sx:{fontWeight:"bold"},children:"Contact Info"}),(0,z.jsx)(p.A,{sx:{fontWeight:"bold"},children:"Reports To"}),(0,z.jsx)(p.A,{sx:{fontWeight:"bold",textAlign:"center"},children:"Actions"})]})}),(0,z.jsx)(b.A,{children:[...Array(5)].map(((e,t)=>(0,z.jsxs)(u.A,{children:[(0,z.jsx)(p.A,{children:(0,z.jsxs)(n.A,{sx:{display:"flex",alignItems:"center"},children:[(0,z.jsx)(v.A,{variant:"circular",width:40,height:40,sx:{mr:1.5}}),(0,z.jsx)(v.A,{variant:"text",width:150})]})}),(0,z.jsx)(p.A,{children:(0,z.jsx)(v.A,{variant:"text",width:100})})," ",(0,z.jsx)(p.A,{children:(0,z.jsx)(v.A,{variant:"text",width:180})}),(0,z.jsx)(p.A,{children:(0,z.jsx)(v.A,{variant:"text",width:150})}),(0,z.jsx)(p.A,{align:"center",children:(0,z.jsxs)(n.A,{sx:{display:"flex",justifyContent:"center",gap:1},children:[(0,z.jsx)(v.A,{variant:"circular",width:32,height:32}),(0,z.jsx)(v.A,{variant:"circular",width:32,height:32})]})})]},t)))})]})})]}):0===te.length?(0,z.jsx)(n.A,{sx:{textAlign:"center",p:4,bgcolor:"rgba(0,0,0,0.02)",borderRadius:2},children:(0,z.jsx)(l.A,{variant:"body1",color:"text.secondary",children:"No marketing staff found matching your criteria"})}):(0,z.jsxs)(f.A,{children:[(0,z.jsxs)(j.A,{children:[(0,z.jsx)(m.A,{children:(0,z.jsxs)(u.A,{children:[(0,z.jsx)(p.A,{sx:{fontWeight:"bold"},children:"Staff Member"}),(0,z.jsx)(p.A,{sx:{fontWeight:"bold"},children:"Role"})," ",(0,z.jsx)(p.A,{sx:{fontWeight:"bold"},children:"Contact Info"}),(0,z.jsx)(p.A,{sx:{fontWeight:"bold"},children:"Reports To"}),(0,z.jsx)(p.A,{sx:{fontWeight:"bold",textAlign:"center"},children:"Actions"})]})}),(0,z.jsx)(b.A,{children:0===re.length?(0,z.jsx)(u.A,{children:(0,z.jsx)(p.A,{colSpan:5,align:"center",children:(0,z.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"No matching results found"})})}):re.map((r=>{var i,s;return(0,z.jsxs)(u.A,{sx:{"&:hover":{bgcolor:"rgba(0,0,0,0.04)"}},children:[(0,z.jsx)(p.A,{children:(0,z.jsxs)(n.A,{sx:{display:"flex",alignItems:"center"},children:[(0,z.jsx)(c.A,{sx:{width:40,height:40,mr:1.5,bgcolor:e.palette.warning.main},children:(null===(i=r.name)||void 0===i?void 0:i.charAt(0))||"?"}),(0,z.jsx)(n.A,{children:(0,z.jsx)(l.A,{variant:"body2",fontWeight:500,children:r.name||"Unknown"})})]})}),(0,z.jsx)(p.A,{children:(0,z.jsx)(l.A,{variant:"body2",children:"MarketingStaff"===r.role?"Marketing Staff":"Supervisor"})}),(0,z.jsx)(p.A,{children:(0,z.jsxs)(n.A,{children:[(0,z.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",mb:.5},children:[(0,z.jsx)(N.A,{sx:{fontSize:16,color:e.palette.warning.main,mr:1}}),(0,z.jsx)(l.A,{variant:"body2",children:r.phoneNumber||"No phone"})]}),(0,z.jsxs)(n.A,{sx:{display:"flex",alignItems:"center"},children:[(0,z.jsx)(R.A,{sx:{fontSize:16,color:e.palette.warning.main,mr:1}}),(0,z.jsx)(l.A,{variant:"body2",children:r.email||"No email"})]})]})}),(0,z.jsx)(p.A,{children:(0,z.jsxs)(n.A,{children:[(0,z.jsx)(l.A,{variant:"body2",fontWeight:500,children:r.managerName||"N/A"}),(0,z.jsx)(l.A,{variant:"caption",color:"text.secondary",children:(null===(s=r.managerRole)||void 0===s?void 0:s.replace(/([A-Z])/g," $1").trim())||"N/A"})]})}),(0,z.jsx)(p.A,{align:"center",children:(0,z.jsxs)(n.A,{sx:{display:"flex",justifyContent:"center",gap:1},children:["MarketingStaff"===r.role&&(0,z.jsx)(y.A,{title:"View Staff Details",children:(0,z.jsx)(w.A,{size:"small",onClick:()=>{return e=r.id,void t(`/sales/staff/${e}/details`);var e},sx:{bgcolor:e.palette.warning.light,color:e.palette.warning.main,"&:hover":{bgcolor:e.palette.warning.light}},children:(0,z.jsx)(W.A,{fontSize:"small"})})}),(0,z.jsx)(y.A,{title:"View Visit History",children:(0,z.jsx)(w.A,{size:"small",onClick:()=>(e=>{"Supervisor"===e.role?t(`/staff/${e.id}/visits`,{state:{staffRole:"Supervisor",dealerVisitIds:e.dealerVisitIds||[]}}):t(`/staff/${e.id}/visits`,{state:{staffRole:"MarketingStaff",visitIds:e.visitIds||[]}})})(r),sx:{bgcolor:e.palette.info.light,color:e.palette.info.main,"&:hover":{bgcolor:e.palette.info.light}},children:(0,z.jsx)(E,{fontSize:"small"})})})]})})]},r.id)}))})]}),(0,z.jsx)(S.A,{rowsPerPageOptions:[10,25,50,100],component:"div",count:te.length,rowsPerPage:Q,page:J,onPageChange:(e,t)=>{K(t)},onRowsPerPageChange:e=>{X(parseInt(e.target.value,10)),K(0)}})]})]})}),(0,z.jsx)(C.A,{open:F.open,autoHideDuration:6e3,onClose:()=>G({...F,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,z.jsx)(I.A,{onClose:()=>G({...F,open:!1}),severity:F.severity,sx:{width:"100%"},children:F.message})})]}):(0,z.jsx)(n.A,{sx:{p:4,textAlign:"center"},children:(0,z.jsx)(l.A,{variant:"h6",color:"error",children:"You are not authorized to view this list."})})}}}]);
//# sourceMappingURL=739.f8c89403.chunk.js.map