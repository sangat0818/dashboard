{"version":3,"file":"static/js/850.429cab37.chunk.js","mappings":"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","sources":["components/StaffVisitHistory.js"],"sourcesContent":["import React, { useEffect, useState, useMemo, useCallback } from 'react';\nimport { useParams, useNavigate, useLocation } from 'react-router-dom';\nimport {\n  Box, Typography, Card, CardContent, Grid, Avatar, Table, TableBody, TableCell, TableContainer, TableHead, TableRow, TablePagination, Chip, Button, LinearProgress, Tooltip, useTheme, Snackbar, Alert, IconButton, Skeleton, TextField, InputAdornment\n} from '@mui/material';\nimport {\n  ArrowBack as ArrowBackIcon,\n  Assessment as AssessmentIcon,\n  PeopleAlt as PeopleIcon,\n  StorefrontOutlined as StoreIcon,\n  InventoryOutlined as InventoryIcon,\n  Person as PersonIcon,\n  ExpandMore as ExpandMoreIcon,\n  ExpandLess as ExpandLessIcon,\n  CalendarToday as CalendarIcon\n} from '@mui/icons-material';\nimport { db } from '../services/firebase';\nimport { doc, getDoc, collection, getDocs } from 'firebase/firestore';\nimport { useAuth } from '../context/AuthContext';\nimport { getSubordinateIds, getSubordinateMarketingStaffIds, canViewStaff } from '../utils/roles';\nimport { Tree, TreeNode } from 'react-organizational-chart';\nimport { format, isToday } from 'date-fns';\n\n// Import Google Maps components \nimport { GoogleMap, useJsApiLoader, Marker, InfoWindow, Polyline } from '@react-google-maps/api';\n\nfunction getInitials(name) {\n  if (!name) return '?';\n  return name\n    .split(' ')\n    .map(part => part[0])\n    .join('')\n    .toUpperCase()\n    .substring(0, 2);\n}\n\n// Add a helper to parse Firestore Timestamp, Date, or string\nfunction toDateSafe(val) {\n  if (!val) return null;\n  if (val instanceof Date) return val;\n  if (val.toDate) return val.toDate();\n  // Try to parse string (e.g., 'May 2, 2025 at 4:03:58 PM UTC+5:30')\n  const parsed = new Date(val);\n  return isNaN(parsed) ? null : parsed;\n}\n\n// Helper: Recursively collect all subordinate marketing staff IDs under a given staffId\nfunction getAllSubordinateMarketingStaffIds(staffId, allUsers) {\n  let result = [];\n  const directSubs = allUsers.filter(u => u.reportingToId === staffId);\n  for (const sub of directSubs) {\n    if (sub.role === 'MarketingStaff') {\n      result.push(sub.id);\n    } else {\n      result = result.concat(getAllSubordinateMarketingStaffIds(sub.id, allUsers));\n    }\n  }\n  return result;\n}\n\n// Google Maps container styles\nconst mapContainerStyle = {\n  width: '100%',\n  height: '400px',\n  borderRadius: '8px'\n};\n\nconst StaffVisitHistory = () => {\n  const theme = useTheme();\n  const navigate = useNavigate();\n  const { staffId } = useParams();\n  const location = useLocation();\n  const isSupervisorVisitHistory = location.state && location.state.staffRole === 'Supervisor';\n  const fallbackStaff = location.state || {};\n  const { userProfile, allUsers: authAllUsers, loading: authLoading } = useAuth();\n\n  const [staff, setStaff] = useState(null);\n  const [allUsers, setAllUsers] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [visits, setVisits] = useState([]);\n  const [snackbar, setSnackbar] = useState({ open: false, message: '', severity: 'success' });\n  const [page, setPage] = useState(0);\n  const [rowsPerPage, setRowsPerPage] = useState(10);\n  const [subordinateStats, setSubordinateStats] = useState([]);\n  const [staffLoading, setStaffLoading] = useState(true);\n  const [productMap, setProductMap] = useState({});\n  const [retailerMap, setRetailerMap] = useState({});\n  const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);\n  const [mapCenter, setMapCenter] = useState({ lat: 20.5937, lng: 78.9629 }); // Default center at India\n  const [mapZoom, setMapZoom] = useState(5);\n  const [selectedMarker, setSelectedMarker] = useState(null);\n  const [expandedRows, setExpandedRows] = useState({});\n\n  // Load Google Maps API\n  const { isLoaded } = useJsApiLoader({\n    id: 'google-map-script',\n    googleMapsApiKey: process.env.REACT_APP_GOOGLE_MAPS_API_KEY // Use environment variable for API key\n  });\n\n  // Filter visits by date\n  const filteredVisits = useMemo(() => {\n    if (!visits || !selectedDate) return visits;\n    \n    return visits.filter(visit => {\n      if (!visit.checkInTime) return false;\n      const visitDate = visit.checkInTime instanceof Date ? visit.checkInTime : new Date(visit.checkInTime);\n      return format(visitDate, 'yyyy-MM-dd') === selectedDate;\n    });\n  }, [visits, selectedDate]);\n\n  // Get map markers from filtered visits\n  const mapMarkers = useMemo(() => {\n    if (!filteredVisits || filteredVisits.length === 0) return [];\n    \n    return filteredVisits\n      .filter(visit => visit.checkInLocation && visit.checkInLocation.latitude && visit.checkInLocation.longitude)\n      .map(visit => ({\n        id: visit.id,\n        position: { lat: visit.checkInLocation.latitude, lng: visit.checkInLocation.longitude },\n        retailerName: retailerMap[visit.retailerId] || retailerMap[visit.dealerId] || 'Unknown',\n        checkInTime: visit.checkInTime,\n        retailerId: visit.retailerId,\n        dealerId: visit.dealerId,\n        products: visit.products || []\n      }))\n      // Sort markers by check-in time to create chronological path\n      .sort((a, b) => {\n        const timeA = a.checkInTime instanceof Date ? a.checkInTime.getTime() : 0;\n        const timeB = b.checkInTime instanceof Date ? b.checkInTime.getTime() : 0;\n        return timeA - timeB;\n      });\n  }, [filteredVisits, retailerMap]);\n\n  // Create path for polyline\n  const mapPath = useMemo(() => {\n    return mapMarkers.map(marker => marker.position);\n  }, [mapMarkers]);\n\n  // Polyline options\n  const polylineOptions = {\n    strokeColor: theme.palette.warning.main,\n    strokeOpacity: 0.8,\n    strokeWeight: 3,\n    geodesic: true\n  };\n\n  // Update map center when markers change\n  useEffect(() => {\n    if (mapMarkers.length > 0) {\n      // Calculate the average center point from all markers\n      const lats = mapMarkers.map(m => m.position.lat);\n      const lngs = mapMarkers.map(m => m.position.lng);\n      \n      const avgLat = lats.reduce((sum, lat) => sum + lat, 0) / lats.length;\n      const avgLng = lngs.reduce((sum, lng) => sum + lng, 0) / lngs.length;\n      \n      setMapCenter({ lat: avgLat, lng: avgLng });\n      \n      // Set appropriate zoom level based on number of markers\n      if (mapMarkers.length === 1) {\n        setMapZoom(15); // Close zoom for single marker\n      } else {\n        // More markers need a wider view\n        setMapZoom(12);\n      }\n    }\n  }, [mapMarkers]);\n\n  // Fetch staff and all users\n  useEffect(() => {\n    setStaffLoading(true);\n    setLoading(true);\n    const fetchData = async () => {\n      try {\n        // Fetch staff\n        const staffDoc = await getDoc(doc(db, 'users', staffId));\n        if (!staffDoc.exists()) {\n          setSnackbar({ open: true, message: 'Staff not found', severity: 'error' });\n          setStaff(null);\n          setStaffLoading(false);\n          setLoading(false);\n          return;\n        }\n        setStaff({ id: staffDoc.id, ...staffDoc.data() });\n        setStaffLoading(false);\n        // Use allUsers from AuthContext\n        setAllUsers(authAllUsers || []);\n      } catch (err) {\n        setSnackbar({ open: true, message: err.message || 'Error loading staff', severity: 'error' });\n        setStaffLoading(false);\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchData();\n  }, [staffId, userProfile, authAllUsers]);\n\n  // Fetch visits if marketing staff or supervisor\n  useEffect(() => {\n    if (!staff) return;\n    // Supervisor logic\n    if (location.state && location.state.staffRole === 'Supervisor') {\n      setLoading(true);\n      const fetchDealerVisits = async () => {\n        try {\n          const dealerVisitIds = location.state.dealerVisitIds || [];\n          if (!Array.isArray(dealerVisitIds) || dealerVisitIds.length === 0) {\n            setVisits([]);\n            setLoading(false);\n            return;\n          }\n          const visitDocs = await Promise.all(\n            dealerVisitIds.map(id => getDoc(doc(db, 'dealerVisits', id)))\n          );\n          const visitsData = visitDocs\n            .filter(docSnap => docSnap.exists())\n            .map(docSnap => {\n              const data = docSnap.data();\n              return {\n                ...data,\n                id: docSnap.id,\n                checkInTime: toDateSafe(data.checkInTime),\n                checkOutTime: toDateSafe(data.checkOutTime),\n              };\n            });\n          setVisits(visitsData);\n        } catch (err) {\n          setSnackbar({ open: true, message: err.message || 'Error loading dealer visits', severity: 'error' });\n        } finally {\n          setLoading(false);\n        }\n      };\n      fetchDealerVisits();\n      return;\n    }\n    // MarketingStaff logic (existing)\n    if (staff.role !== 'MarketingStaff') return;\n    setLoading(true);\n    const fetchVisits = async () => {\n      try {\n        const visitIds = staff.visitIds || [];\n        if (!Array.isArray(visitIds) || visitIds.length === 0) {\n          setVisits([]);\n          setLoading(false);\n          return;\n        }\n        const visitDocs = await Promise.all(\n          visitIds.map(id => getDoc(doc(db, 'visits', id)))\n        );\n        const visitsData = visitDocs\n          .filter(docSnap => docSnap.exists())\n          .map(docSnap => {\n            const data = docSnap.data();\n            return {\n              ...data,\n              id: docSnap.id,\n              checkInTime: toDateSafe(data.checkInTime),\n              checkOutTime: toDateSafe(data.checkOutTime),\n            };\n          });\n        setVisits(visitsData);\n      } catch (err) {\n        setSnackbar({ open: true, message: err.message || 'Error loading visits', severity: 'error' });\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchVisits();\n  }, [staff, location.state]);\n\n  // Fetch subordinate stats if not marketing staff\n  useEffect(() => {\n    if (!staff || staff.role === 'MarketingStaff') return;\n    setLoading(true);\n    const fetchSubordinateStats = async () => {\n      try {\n        // Get direct subordinates (fix: use reportingToId)\n        const directSubs = allUsers.filter(u => u.reportingToId === staff.id);\n        // For each, get stats (recursively aggregate for non-marketing staff)\n        const stats = await Promise.all(directSubs.map(async (sub) => {\n          let visitCount = 0;\n          let retailersReached = 0;\n          let cartonsSold = 0;\n          let totalSalesAmount = 0;\n          let marketingStaffIds = [];\n          if (sub.role === 'MarketingStaff') {\n            marketingStaffIds = [sub.id];\n          } else {\n            marketingStaffIds = getAllSubordinateMarketingStaffIds(sub.id, allUsers);\n          }\n          if (marketingStaffIds.length > 0) {\n            // Fetch all visits for all subordinate marketing staff\n            let allVisitIds = [];\n            for (const msId of marketingStaffIds) {\n              const ms = allUsers.find(u => u.id === msId);\n              if (ms && Array.isArray(ms.visitIds)) {\n                allVisitIds = allVisitIds.concat(ms.visitIds);\n              }\n            }\n            if (allVisitIds.length > 0) {\n              const visitDocs = await Promise.all(\n                allVisitIds.map(id => getDoc(doc(db, 'visits', id)))\n              );\n              visitCount = visitDocs.length;\n              retailersReached = new Set(visitDocs.map(v => v.data()?.retailerId)).size;\n              \n              // Calculate both cartons sold and total sales amount\n              visitDocs.forEach(visit => {\n                const visitData = visit.data();\n                const products = visitData?.products || [];\n                \n                products.forEach(product => {\n                  const count = parseInt(product.count) || 0;\n                  cartonsSold += count;\n                  \n                  // Calculate sales amount based on product rate\n                  if (product.rate) {\n                    totalSalesAmount += count * parseFloat(product.rate);\n                  }\n                });\n              });\n            }\n          }\n          return {\n            id: sub.id,\n            name: sub.name,\n            role: sub.role,\n            status: sub.active ? 'Active' : 'Inactive',\n            visitCount,\n            retailersReached,\n            cartonsSold,\n            totalSalesAmount\n          };\n        }));\n        setSubordinateStats(stats);\n      } catch (err) {\n        setSnackbar({ open: true, message: err.message || 'Error loading subordinate stats', severity: 'error' });\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchSubordinateStats();\n  }, [staff, allUsers]);\n\n  // Fetch all products for name lookup\n  useEffect(() => {\n    const fetchProducts = async () => {\n      try {\n        const productsCollection = collection(db, 'products');\n        const productSnapshot = await getDocs(productsCollection);\n        const pMap = {};\n        productSnapshot.docs.forEach(doc => {\n          const d = doc.data();\n          pMap[doc.id] = d;\n        });\n        setProductMap(pMap);\n      } catch (error) {\n        setProductMap({});\n      }\n    };\n    fetchProducts();\n  }, []);\n\n  // Fetch only required retailers\n  useEffect(() => {\n    // Collect unique retailerIds or dealerIds from visits\n    let ids = [];\n    if (isSupervisorVisitHistory) {\n      ids = Array.from(new Set(visits.map(v => v.dealerId).filter(Boolean)));\n    } else {\n      ids = Array.from(new Set(visits.map(v => v.retailerId).filter(Boolean)));\n    }\n    if (ids.length === 0) {\n      setRetailerMap({});\n      return;\n    }\n    // Firestore 'in' queries support up to 10 items per query\n    const fetchEntitiesByIds = async () => {\n      try {\n        let rMap = {};\n        for (let i = 0; i < ids.length; i += 10) {\n          const batchIds = ids.slice(i, i + 10);\n          const q = batchIds.map(id => getDoc(doc(db, isSupervisorVisitHistory ? 'dealers' : 'retailers', id)));\n          const docs = await Promise.all(q);\n          docs.forEach(docSnap => {\n            if (docSnap.exists()) {\n              const d = docSnap.data();\n              rMap[docSnap.id] = d.name;\n            }\n          });\n        }\n        setRetailerMap(rMap);\n      } catch (error) {\n        setRetailerMap({});\n      }\n    };\n    fetchEntitiesByIds();\n  }, [visits, isSupervisorVisitHistory]);\n\n  // Access control: only allow if user can view this staff\n  const canView = useMemo(() => {\n    if (!userProfile || !staff) return undefined; // undefined means still loading\n    if (userProfile.role === 'Admin') return true;\n    // Use getSubordinateIds to check if staffId is in user's scope\n    const myId = userProfile.id;\n    const allowedIds = getSubordinateIds(myId, allUsers);\n    return staff.id === myId || allowedIds.includes(staff.id);\n  }, [userProfile, staff, allUsers]);\n\n  // Helper to build the hierarchy tree recursively\n  function buildHierarchyTree(staffId, allUsers) {\n    const staff = allUsers.find(u => u.id === staffId);\n    if (!staff) return null;\n    const subordinates = allUsers.filter(u => u.reportingToId === staffId);\n    return {\n      ...staff,\n      subordinates: subordinates.map(sub => buildHierarchyTree(sub.id, allUsers)).filter(Boolean)\n    };\n  }\n\n  // Helper to render the tree nodes\n  function renderTreeNode(node, theme) {\n    if (!node) return null;\n    return (\n      <TreeNode\n        label={\n          <Box sx={{ display: 'flex', alignItems: 'center', bgcolor: theme.palette.warning.light, color: theme.palette.warning.contrastText || '#fff', borderRadius: 2, px: 2, py: 1, boxShadow: 1 }}>\n            <Avatar sx={{ bgcolor: theme.palette.warning.main, color: '#fff', width: 36, height: 36, mr: 1 }}>{getInitials(node.name)}</Avatar>\n            <Box>\n              <Typography variant=\"subtitle2\" fontWeight={600}>{node.name}</Typography>\n              <Typography variant=\"caption\" color=\"text.secondary\">{node.role}</Typography>\n            </Box>\n          </Box>\n        }\n      >\n        {Array.isArray(node.subordinates) && node.subordinates.length > 0 && node.subordinates.map(sub => renderTreeNode(sub, theme))}\n      </TreeNode>\n    );\n  }\n  \n  const handleToggleExpand = (visitId) => {\n    setExpandedRows((prev) => ({ ...prev, [visitId]: !prev[visitId] }));\n  };\n  \n  // Handle marker click to show InfoWindow\n  const handleMarkerClick = (marker) => {\n    setSelectedMarker(marker);\n  };\n\n  // Always render the main layout, but handle loading/unauthorized\n  if (authLoading || staffLoading || canView === undefined) {\n    // Show header with fallbackStaff if available, otherwise skeletons\n    return (\n      <Box sx={{ p: 3 }}>\n        <Card sx={{ mb: 4, borderRadius: 2, boxShadow: theme.shadows[2] }}>\n          <CardContent sx={{ p: 3 }}>\n            <Grid container spacing={2}>\n              <Grid item xs={12} md={6}>\n                <Box sx={{ display: 'flex', alignItems: 'center' }}>\n                  {fallbackStaff.name ? (\n                    <>\n                      <Skeleton variant=\"circular\" width={60} height={60} sx={{ mr: 2 }} />\n                      <Box>\n                        <Typography variant=\"h5\" gutterBottom fontWeight=\"bold\">{fallbackStaff.name}</Typography>\n                        <Typography variant=\"body2\" color=\"text.secondary\">{fallbackStaff.email}</Typography>\n                        <Typography variant=\"body2\" color=\"text.secondary\">{fallbackStaff.phoneNumber}</Typography>\n                      </Box>\n                    </>\n                  ) : (\n                    <>\n                      <Skeleton variant=\"circular\" width={60} height={60} sx={{ mr: 2 }} />\n                      <Box sx={{ flex: 1 }}>\n                        <Skeleton variant=\"text\" width={180} height={32} sx={{ mb: 1 }} />\n                        <Skeleton variant=\"text\" width={120} height={20} sx={{ mb: 0.5 }} />\n                        <Skeleton variant=\"text\" width={100} height={20} />\n                      </Box>\n                    </>\n                  )}\n                </Box>\n              </Grid>\n              <Grid item xs={12} md={6}>\n                <Box sx={{ display: 'flex', justifyContent: { xs: 'flex-start', md: 'flex-end' }, gap: 3, mt: { xs: 2, md: 0 }, height: '100%', alignItems: 'center' }}>\n                  <Box sx={{ textAlign: { xs: 'left', md: 'center' } }}>\n                    <Skeleton variant=\"text\" width={80} height={36} />\n                    <Skeleton variant=\"text\" width={60} height={20} />\n                  </Box>\n                </Box>\n              </Grid>\n            </Grid>\n          </CardContent>\n        </Card>\n        <Card sx={{ borderRadius: 2, boxShadow: theme.shadows[2] }}>\n          <CardContent sx={{ p: 3 }}>\n            <LinearProgress sx={{ mt: 2, mb: 1, borderRadius: 1 }} />\n          </CardContent>\n        </Card>\n      </Box>\n    );\n  }\n\n  if (canView === false) {\n    return (\n      <Box sx={{ p: 4, textAlign: 'center' }}>\n        <Typography variant=\"h6\" color=\"error\">You are not authorized to view this staff's data.</Typography>\n        <Button variant=\"contained\" onClick={() => navigate(-1)} sx={{ mt: 2 }} startIcon={<ArrowBackIcon />}>Back</Button>\n      </Box>\n    );\n  }\n\n  // Main content (as before)\n  const visitEntityLabel = isSupervisorVisitHistory ? 'Dealer' : 'Retailer';\n  return (\n    <Box sx={{ p: 3 }}>\n      {/* Header Card: Staff Info */}\n      <Card sx={{ mb: 4, borderRadius: 2, boxShadow: theme.shadows[2] }}>\n        <CardContent sx={{ p: 3 }}>\n          <Grid container spacing={2}>\n            <Grid item xs={12} md={6}>\n              <Box sx={{ display: 'flex', alignItems: 'center' }}>\n                {staffLoading ? (\n                  fallbackStaff.name ? (\n                    <>\n                      <Skeleton variant=\"circular\" width={60} height={60} sx={{ mr: 2 }} />\n                      <Box>\n                        <Typography variant=\"h5\" gutterBottom fontWeight=\"bold\">{fallbackStaff.name}</Typography>\n                        <Typography variant=\"body2\" color=\"text.secondary\">{fallbackStaff.email}</Typography>\n                        <Typography variant=\"body2\" color=\"text.secondary\">{fallbackStaff.phoneNumber}</Typography>\n                      </Box>\n                    </>\n                  ) : (\n                    <>\n                      <Skeleton variant=\"circular\" width={60} height={60} sx={{ mr: 2 }} />\n                      <Box sx={{ flex: 1 }}>\n                        <Skeleton variant=\"text\" width={180} height={32} sx={{ mb: 1 }} />\n                        <Skeleton variant=\"text\" width={120} height={20} sx={{ mb: 0.5 }} />\n                        <Skeleton variant=\"text\" width={100} height={20} />\n                      </Box>\n                    </>\n                  )\n                ) : staff ? (\n                  <>\n                    <Avatar sx={{ bgcolor: theme.palette.warning.light, color: theme.palette.warning.contrastText || '#fff', width: 60, height: 60, mr: 2, fontSize: '1.5rem' }}>\n                      <PersonIcon sx={{ fontSize: 30 }} />\n                    </Avatar>\n                    <Box>\n                      <Typography variant=\"h5\" gutterBottom fontWeight=\"bold\">{staff.name}</Typography>\n                      <Typography variant=\"body2\" color=\"text.secondary\">{staff.email}</Typography>\n                      <Typography variant=\"body2\" color=\"text.secondary\">{staff.phoneNumber}</Typography>\n                    </Box>\n                  </>\n                ) : null}\n              </Box>\n            </Grid>\n            <Grid item xs={12} md={6}>\n              <Box sx={{ display: 'flex', justifyContent: { xs: 'flex-start', md: 'flex-end' }, gap: 3, mt: { xs: 2, md: 0 }, height: '100%', alignItems: 'center' }}>\n                <Box sx={{ textAlign: { xs: 'left', md: 'center' } }}>\n                  {staff && staff.role === 'MarketingStaff' ? (\n                    <>\n                    </>\n                  ) : null}\n                </Box>\n              </Box>\n            </Grid>\n          </Grid>\n        </CardContent>\n      </Card>\n\n      {/* Main Content: Visits or Subordinate Stats */}\n      {(staff && (staff.role === 'MarketingStaff' || isSupervisorVisitHistory)) ? (\n        <>\n          {/* Map Card */}\n          <Card sx={{ borderRadius: 2, boxShadow: theme.shadows[2], mb: 4 }}>\n            <CardContent sx={{ p: 3 }}>\n              <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>\n                <Typography variant=\"h6\" fontWeight=\"bold\">\n                  <StoreIcon sx={{ mr: 1, verticalAlign: 'text-bottom' }} />\n                  Visit Locations\n                </Typography>\n                <TextField\n                  label=\"Select Date\"\n                  type=\"date\"\n                  size=\"small\"\n                  value={selectedDate}\n                  onChange={(e) => setSelectedDate(e.target.value)}\n                  InputLabelProps={{ shrink: true }}\n                  sx={{ minWidth: 180 }}\n                  InputProps={{\n                    startAdornment: (\n                      <InputAdornment position=\"start\">\n                        <CalendarIcon color=\"action\" />\n                      </InputAdornment>\n                    ),\n                  }}\n                />\n              </Box>\n              \n              {loading ? (\n                <LinearProgress sx={{ mt: 2, mb: 1, borderRadius: 1 }} />\n              ) : mapMarkers.length === 0 ? (\n                <Box sx={{ p: 3, textAlign: 'center', backgroundColor: 'rgba(0,0,0,0.02)' }}>\n                  <Typography variant=\"body1\" color=\"text.secondary\">No location data available for selected date</Typography>\n                </Box>\n              ) : isLoaded ? (\n                <Box sx={{ height: 400, width: '100%', mb: 2 }}>\n                  <GoogleMap\n                    mapContainerStyle={mapContainerStyle}\n                    center={mapCenter}\n                    zoom={mapZoom}\n                    options={{\n                      mapTypeControl: false,\n                      streetViewControl: false,\n                      fullscreenControl: true,\n                    }}\n                  >\n                    {/* Add polyline to connect markers */}\n                    {mapPath.length > 1 && (\n                      <Polyline\n                        path={mapPath}\n                        options={polylineOptions}\n                      />\n                    )}\n                    \n                    {mapMarkers.map((marker, index) => (\n                      <Marker \n                        key={marker.id} \n                        position={marker.position}\n                        onClick={() => handleMarkerClick(marker)}\n                        label={index > 0 ? `${index + 1}` : undefined}\n                      />\n                    ))}\n                    \n                    {selectedMarker && (\n                      <InfoWindow\n                        position={selectedMarker.position}\n                        onCloseClick={() => setSelectedMarker(null)}\n                      >\n                        <Box sx={{ p: 1 }}>\n                          <Typography variant=\"subtitle2\" fontWeight=\"bold\">{selectedMarker.retailerName}</Typography>\n                          <Typography variant=\"body2\">\n                            {selectedMarker.checkInTime instanceof Date \n                              ? format(selectedMarker.checkInTime, 'MMM d, yyyy, h:mm a') \n                              : 'Unknown time'}\n                          </Typography>\n                          {selectedMarker.products.length > 0 && (\n                            <Typography variant=\"caption\" display=\"block\" sx={{ mt: 1 }}>\n                              Products: {selectedMarker.products.length}\n                            </Typography>\n                          )}\n                        </Box>\n                      </InfoWindow>\n                    )}\n                  </GoogleMap>\n                </Box>\n              ) : (\n                <Box sx={{ p: 3, textAlign: 'center', backgroundColor: 'rgba(0,0,0,0.02)' }}>\n                  <Typography variant=\"body1\" color=\"text.secondary\">Loading Google Maps...</Typography>\n                </Box>\n              )}\n              \n              <Box sx={{ display: 'flex', justifyContent: 'space-between', mt: 2 }}>\n                <Typography variant=\"body2\" color=\"text.secondary\">\n                  Showing {mapMarkers.length} location{mapMarkers.length !== 1 ? 's' : ''} for {selectedDate ? format(new Date(selectedDate), 'MMMM d, yyyy') : 'today'}\n                </Typography>\n                {mapMarkers.length > 0 && (\n                  <Button \n                    size=\"small\" \n                    variant=\"outlined\"\n                    onClick={() => {\n                      if (mapMarkers.length === 1) {\n                        setMapCenter(mapMarkers[0].position);\n                        setMapZoom(15);\n                      } else if (mapMarkers.length > 1) {\n                        // Recenter to the average position\n                        const lats = mapMarkers.map(m => m.position.lat);\n                        const lngs = mapMarkers.map(m => m.position.lng);\n                        const avgLat = lats.reduce((sum, lat) => sum + lat, 0) / lats.length;\n                        const avgLng = lngs.reduce((sum, lng) => sum + lng, 0) / lngs.length;\n                        setMapCenter({ lat: avgLat, lng: avgLng });\n                        setMapZoom(12);\n                      }\n                    }}\n                    sx={{ borderRadius: '2rem' }}\n                  >\n                    Fit to Markers\n                  </Button>\n                )}\n              </Box>\n            </CardContent>\n          </Card>\n          \n          {/* Visit Records Card */}\n          <Card sx={{ borderRadius: 2, boxShadow: theme.shadows[2] }}>\n            <CardContent sx={{ p: 3 }}>\n              <Box sx={{ mt: 0 }}>\n                <Typography variant=\"h6\" fontWeight=\"bold\" sx={{ mb: 2 }}>\n                  <InventoryIcon sx={{ mr: 1, verticalAlign: 'text-bottom' }} />\n                  Visit Records\n                </Typography>\n                {loading ? (\n                  <LinearProgress sx={{ mt: 2, mb: 1, borderRadius: 1 }} />\n                ) : filteredVisits.length === 0 ? (\n                  <Box sx={{ p: 3, textAlign: 'center', backgroundColor: 'rgba(0,0,0,0.02)' }}>\n                    <Typography variant=\"body1\" color=\"text.secondary\">No visit data available for selected date</Typography>\n                  </Box>\n                ) : (\n                  <TableContainer>\n                    <Table>\n                      <TableHead>\n                        <TableRow>\n                          <TableCell sx={{ fontWeight: 'bold' }}>Check-in</TableCell>\n                          <TableCell sx={{ fontWeight: 'bold' }}>Check-out</TableCell>\n                          <TableCell sx={{ fontWeight: 'bold' }}>Duration</TableCell>\n                          <TableCell sx={{ fontWeight: 'bold' }}>{visitEntityLabel}</TableCell>\n                          <TableCell sx={{ fontWeight: 'bold' }}>Notes</TableCell>\n                          <TableCell sx={{ fontWeight: 'bold' }}>Products Sold</TableCell>\n                        </TableRow>\n                      </TableHead>\n                      <TableBody>\n                        {filteredVisits.slice(page * rowsPerPage, page * rowsPerPage + rowsPerPage).map((visit) => [\n                          <TableRow key={visit.id} sx={{ '&:hover': { backgroundColor: 'rgba(0,0,0,0.04)' } }}>\n                            <TableCell>\n                              {visit.checkInTime instanceof Date && !isNaN(visit.checkInTime) ? format(visit.checkInTime, 'MMM d, yyyy, h:mm a') : 'N/A'}\n                            </TableCell>\n                            <TableCell>\n                              {visit.checkOutTime instanceof Date && !isNaN(visit.checkOutTime) ? format(visit.checkOutTime, 'MMM d, yyyy, h:mm a') : 'N/A'}\n                            </TableCell>\n                            <TableCell>\n                              {visit.checkInTime instanceof Date && !isNaN(visit.checkInTime) && \n                               visit.checkOutTime instanceof Date && !isNaN(visit.checkOutTime) ? \n                                (() => {\n                                  const durationMs = visit.checkOutTime.getTime() - visit.checkInTime.getTime();\n                                  const minutes = Math.floor(durationMs / 60000);\n                                  if (minutes < 60) {\n                                    return `${minutes} min${minutes !== 1 ? 's' : ''}`;\n                                  } else {\n                                    const hours = Math.floor(minutes / 60);\n                                    const remainingMins = minutes % 60;\n                                    return `${hours} hr${hours !== 1 ? 's' : ''} ${remainingMins} min${remainingMins !== 1 ? 's' : ''}`;\n                                  }\n                                })() : 'N/A'}\n                            </TableCell>\n                            <TableCell>{retailerMap[visit.retailerId] || retailerMap[visit.dealerId] || 'N/A'}</TableCell>\n                            <TableCell>{visit.notes || ''}</TableCell>\n                            <TableCell>\n                              {Array.isArray(visit.products) && visit.products.length > 0 ? (\n                                <>\n                                  <Box sx={{ display: 'flex', alignItems: 'center' }}>\n                                    <Typography variant=\"body2\" sx={{ mr: 1 }}>\n                                      {expandedRows[visit.id]\n                                        ? ''\n                                        : `${visit.products.length} product${visit.products.length > 1 ? 's' : ''}`}\n                                    </Typography>\n                                    <IconButton\n                                      size=\"small\"\n                                      onClick={() => handleToggleExpand(visit.id)}\n                                      aria-label={expandedRows[visit.id] ? 'Collapse products' : 'Expand products'}\n                                    >\n                                      {expandedRows[visit.id] ? <ExpandLessIcon /> : <ExpandMoreIcon />}\n                                    </IconButton>\n                                  </Box>\n                                </>\n                              ) : ''}\n                            </TableCell>\n                          </TableRow>,\n                          expandedRows[visit.id] && (\n                            <TableRow key={`${visit.id}-expanded`}>\n                              <TableCell colSpan={5} sx={{ py: 0, borderBottom: 'none' }}>\n                                <Box sx={{ py: 2 }}>\n                                  <Table size=\"small\">\n                                    <TableHead>\n                                      <TableRow>\n                                        <TableCell sx={{ fontWeight: 600, color: theme.palette.warning.main, borderBottom: 'none', py: 0.5 }}>Product Name</TableCell>\n                                        <TableCell sx={{ fontWeight: 600, color: theme.palette.warning.main, borderBottom: 'none', py: 0.5 }}>Count</TableCell>\n                                      </TableRow>\n                                    </TableHead>\n                                    <TableBody>\n                                      {visit.products.map((product, idx) => (\n                                        <TableRow key={idx}>\n                                          <TableCell sx={{ borderBottom: 'none', py: 0.5 }}>\n                                            {productMap[product.productId]?.name || 'Product'}\n                                          </TableCell>\n                                          <TableCell sx={{ borderBottom: 'none', py: 0.5 }}>\n                                            {product.count}\n                                          </TableCell>\n                                        </TableRow>\n                                      ))}\n                                    </TableBody>\n                                  </Table>\n                                </Box>\n                              </TableCell>\n                            </TableRow>\n                          )\n                        ])}\n                      </TableBody>\n                    </Table>\n                  </TableContainer>\n                )}\n                <TablePagination\n                  rowsPerPageOptions={[5, 10, 25]}\n                  component=\"div\"\n                  count={filteredVisits.length}\n                  rowsPerPage={rowsPerPage}\n                  page={page}\n                  onPageChange={(e, newPage) => setPage(newPage)}\n                  onRowsPerPageChange={e => { setRowsPerPage(parseInt(e.target.value, 10)); setPage(0); }}\n                />\n              </Box>\n            </CardContent>\n          </Card>\n        </>\n      ) : staff && staff.role !== 'MarketingStaff' ? (\n        <Card sx={{ borderRadius: 2, boxShadow: theme.shadows[2], mb: 4 }}>\n          <CardContent sx={{ p: 3 }}>\n            <Typography variant=\"h6\" fontWeight=\"bold\" sx={{ mb: 2 }}>\n              <AssessmentIcon sx={{ mr: 1, verticalAlign: 'text-bottom' }} />\n              Direct Subordinates\n            </Typography>\n            {loading ? (\n              <LinearProgress sx={{ mt: 2, mb: 1, borderRadius: 1 }} />\n            ) : subordinateStats.length === 0 ? (\n              <Box sx={{ p: 3, textAlign: 'center', backgroundColor: 'rgba(0,0,0,0.02)' }}>\n                <Typography variant=\"body1\" color=\"text.secondary\">No direct subordinates found</Typography>\n              </Box>\n            ) : (\n              <TableContainer>\n                <Table>\n                  <TableHead>\n                    <TableRow>\n                      <TableCell sx={{ fontWeight: 'bold' }}>Name</TableCell>\n                      <TableCell sx={{ fontWeight: 'bold' }}>Role</TableCell>\n                      <TableCell sx={{ fontWeight: 'bold' }}>Status</TableCell>\n                      <TableCell sx={{ fontWeight: 'bold' }}>Visits</TableCell>\n                      <TableCell sx={{ fontWeight: 'bold' }}>Retailers Reached</TableCell>\n                      <TableCell sx={{ fontWeight: 'bold' }}>Cartons Sold</TableCell>\n                      <TableCell sx={{ fontWeight: 'bold' }}>Sales Amount</TableCell>\n                      <TableCell align=\"right\" sx={{ fontWeight: 'bold' }}>Actions</TableCell>\n                    </TableRow>\n                  </TableHead>\n                  <TableBody>\n                    {subordinateStats.slice(page * rowsPerPage, page * rowsPerPage + rowsPerPage).map((sub) => (\n                      <TableRow key={sub.id} sx={{ '&:hover': { backgroundColor: 'rgba(0,0,0,0.04)' } }}>\n                        <TableCell>\n                          <Box sx={{ display: 'flex', alignItems: 'center' }}>\n                            <Avatar sx={{ bgcolor: theme.palette.warning.light, color: theme.palette.warning.contrastText || '#fff', width: 36, height: 36, mr: 2, fontSize: '0.9rem' }}>{getInitials(sub.name)}</Avatar>\n                            <Typography variant=\"subtitle2\">{sub.name}</Typography>\n                          </Box>\n                        </TableCell>\n                        <TableCell>{sub.role}</TableCell>\n                        <TableCell>\n                          <Chip label={sub.status} color={sub.status === 'Active' ? 'success' : 'default'} size=\"small\" sx={{ borderRadius: '14px', fontWeight: 500 }} />\n                        </TableCell>\n                        <TableCell>{sub.visitCount}</TableCell>\n                        <TableCell>{sub.retailersReached}</TableCell>\n                        <TableCell>{sub.cartonsSold}</TableCell>\n                        <TableCell>\n                          <Typography variant=\"body2\" fontWeight={600} color={theme.palette.success.main}>\n                            {sub.totalSalesAmount.toFixed(2)}\n                          </Typography>\n                        </TableCell>\n                        <TableCell align=\"right\">\n                          <Tooltip title=\"View Details\">\n                            <IconButton onClick={() => navigate(`/staff/${sub.id}/visits`)} size=\"small\" sx={{ ml: 1, color: theme.palette.warning.main, bgcolor: 'rgba(255, 152, 0, 0.08)', '&:hover': { bgcolor: 'rgba(255, 152, 0, 0.12)' } }}>\n                              <AssessmentIcon fontSize=\"small\" />\n                            </IconButton>\n                          </Tooltip>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </TableContainer>\n            )}\n            <TablePagination\n              rowsPerPageOptions={[5, 10, 25]}\n              component=\"div\"\n              count={subordinateStats.length}\n              rowsPerPage={rowsPerPage}\n              page={page}\n              onPageChange={(e, newPage) => setPage(newPage)}\n              onRowsPerPageChange={e => { setRowsPerPage(parseInt(e.target.value, 10)); setPage(0); }}\n            />\n          </CardContent>\n        </Card>\n      ) : null}\n      <Button variant=\"outlined\" onClick={() => navigate(-1)} sx={{ mt: 3 }} startIcon={<ArrowBackIcon />}>Back</Button>\n      <Snackbar\n        open={snackbar.open}\n        autoHideDuration={6000}\n        onClose={() => setSnackbar({ ...snackbar, open: false })}\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}\n      >\n        <Alert\n          onClose={() => setSnackbar({ ...snackbar, open: false })}\n          severity={snackbar.severity}\n          sx={{ width: '100%', boxShadow: theme.shadows[3], borderRadius: 2 }}\n        >\n          {snackbar.message}\n        </Alert>\n      </Snackbar>\n    </Box>\n  );\n};\n\nexport default StaffVisitHistory;"],"names":["getInitials","name","split","map","part","join","toUpperCase","substring","toDateSafe","val","Date","toDate","parsed","isNaN","getAllSubordinateMarketingStaffIds","staffId","allUsers","result","directSubs","filter","u","reportingToId","sub","role","push","id","concat","mapContainerStyle","width","height","borderRadius","StaffVisitHistory","theme","useTheme","navigate","useNavigate","useParams","location","useLocation","isSupervisorVisitHistory","state","staffRole","fallbackStaff","userProfile","authAllUsers","loading","authLoading","useAuth","staff","setStaff","useState","setAllUsers","setLoading","visits","setVisits","snackbar","setSnackbar","open","message","severity","page","setPage","rowsPerPage","setRowsPerPage","subordinateStats","setSubordinateStats","staffLoading","setStaffLoading","productMap","setProductMap","retailerMap","setRetailerMap","selectedDate","setSelectedDate","toISOString","mapCenter","setMapCenter","lat","lng","mapZoom","setMapZoom","selectedMarker","setSelectedMarker","expandedRows","setExpandedRows","isLoaded","useJsApiLoader","googleMapsApiKey","process","filteredVisits","useMemo","visit","checkInTime","visitDate","format","mapMarkers","length","checkInLocation","latitude","longitude","position","retailerName","retailerId","dealerId","products","sort","a","b","getTime","mapPath","marker","polylineOptions","strokeColor","palette","warning","main","strokeOpacity","strokeWeight","geodesic","useEffect","lats","m","lngs","avgLat","reduce","sum","avgLng","async","staffDoc","getDoc","doc","db","exists","data","err","fetchData","dealerVisitIds","Array","isArray","visitsData","Promise","all","docSnap","checkOutTime","fetchDealerVisits","visitIds","fetchVisits","stats","visitCount","retailersReached","cartonsSold","totalSalesAmount","marketingStaffIds","allVisitIds","msId","ms","find","visitDocs","Set","v","_v$data","size","forEach","visitData","product","count","parseInt","rate","parseFloat","status","active","fetchSubordinateStats","productsCollection","collection","productSnapshot","getDocs","pMap","docs","d","error","fetchProducts","ids","from","Boolean","rMap","i","q","slice","fetchEntitiesByIds","canView","myId","allowedIds","getSubordinateIds","includes","undefined","_jsxs","Box","sx","p","children","_jsx","Card","mb","boxShadow","shadows","CardContent","Grid","container","spacing","item","xs","md","display","alignItems","_Fragment","Skeleton","variant","mr","Typography","gutterBottom","fontWeight","color","email","phoneNumber","flex","justifyContent","gap","mt","textAlign","LinearProgress","Button","onClick","startIcon","ArrowBackIcon","visitEntityLabel","Avatar","bgcolor","light","contrastText","fontSize","PersonIcon","StoreIcon","verticalAlign","TextField","label","type","value","onChange","e","target","InputLabelProps","shrink","minWidth","InputProps","startAdornment","InputAdornment","CalendarIcon","backgroundColor","GoogleMap","center","zoom","options","mapTypeControl","streetViewControl","fullscreenControl","Polyline","path","index","Marker","handleMarkerClick","InfoWindow","onCloseClick","InventoryIcon","TableContainer","Table","TableHead","TableRow","TableCell","TableBody","durationMs","minutes","Math","floor","hours","remainingMins","notes","IconButton","handleToggleExpand","visitId","prev","ExpandLessIcon","ExpandMoreIcon","colSpan","py","borderBottom","idx","_productMap$product$p","productId","TablePagination","rowsPerPageOptions","component","onPageChange","newPage","onRowsPerPageChange","AssessmentIcon","align","Chip","success","toFixed","Tooltip","title","ml","Snackbar","autoHideDuration","onClose","anchorOrigin","vertical","horizontal","Alert"],"sourceRoot":""}